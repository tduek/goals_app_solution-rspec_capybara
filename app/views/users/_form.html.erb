<% action = user.persisted? ? user_url(user) : users_url %>

<form action="<%= action %>" method="post">

  <input type="hidden" name="authenticity_token"
                      value="<%= form_authenticity_token %>">

  <% if user.persisted? %>
  <input type="hidden" name="method" value="put">
  <% end %>

  <label for="user_username">Username</label>
  <input type="text" id="user_username" name="user[username]"
                                       value="<%= user.username %>">

  <label for="user_password">Password</label>
  <input type="password" id="user_password" name="user[password]">

  <input type="submit" name="commit" value="Save">

</form>